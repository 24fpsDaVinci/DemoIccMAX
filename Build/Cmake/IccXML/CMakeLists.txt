IF(USE_SYSTEM_LIBXML2)
  FIND_PACKAGE(LibXML2 REQUIRED)
ELSE()
  FIND_PACKAGE(LibXML2)
ENDIF()
IF(LIBXML2_FOUND)
  INCLUDE_DIRECTORIES( ${LIBXML2_INCLUDE_DIR} )
  LINK_DIRECTORIES( ${LIBXML2_LIBRARY_DIRS} )
  SET( HAVE_LIBXML2 1 )
ELSE( LIBXML2_FOUND )
  IF(CMAKE_VERSION VERSION_GREATER 2.8.0)
    SET( HAVE_LIBXML2 TRUE  )
    INCLUDE_DIRECTORIES( ${CMAKE_CURRENT_SOURCE_DIR}/libxml2 )
    LINK_DIRECTORIES( ${CMAKE_CURRENT_BINARY_DIR}/libxml2 )
    ADD_SUBDIRECTORY( libxml2 )
    SET( LIBXML2_LIBRARIES xml2-static )
  ENDIF()
ENDIF(LIBXML2_FOUND)

SET( SRC_PATH ../../.. )
SET( CFILES
	${SRC_PATH}/IccXML/IccLibXML/IccIoXml.cpp
	${SRC_PATH}/IccXML/IccLibXML/IccMpeXml.cpp
	${SRC_PATH}/IccXML/IccLibXML/IccMpeXmlFactory.cpp
	${SRC_PATH}/IccXML/IccLibXML/IccProfileXml.cpp
	${SRC_PATH}/IccXML/IccLibXML/IccTagXml.cpp
	${SRC_PATH}/IccXML/IccLibXML/IccTagXmlFactory.cpp
	${SRC_PATH}/IccXML/IccLibXML/IccUtilXml.cpp
  )

IF(ENABLE_INSTALL_RIM)
  SET( HEADERS_PUBLIC
	${SRC_PATH}/IccXML/IccLibXML/IccIoXml.h
	${SRC_PATH}/IccXML/IccLibXML/IccLibXMLVer.h
	${SRC_PATH}/IccXML/IccLibXML/IccMpeXmlFactory.h
	${SRC_PATH}/IccXML/IccLibXML/IccMpeXml.h
	${SRC_PATH}/IccXML/IccLibXML/IccProfileXml.h
	${SRC_PATH}/IccXML/IccLibXML/IccTagXmlFactory.h
	${SRC_PATH}/IccXML/IccLibXML/IccTagXml.h
	${SRC_PATH}/IccXML/IccLibXML/IccUtilXml.h
	${SRC_PATH}/IccXML/IccLibXML/IccXmlConfig.h
  )
  INSTALL( FILES
	     ${HEADERS_PUBLIC}
	     DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/${TARGET_INCLUDE_FOLDER}/IccXML/ )
ENDIF(ENABLE_INSTALL_RIM)

SET( SOURCES ${CFILES} )

IF(APPLE)
   INCLUDE_DIRECTORIES ( /Developer/Headers/FlatCarbon )
   FIND_LIBRARY( CARBON_LIBRARY Carbon )
   FIND_LIBRARY( IOKIT_LIBRARY IOKit )
   MARK_AS_ADVANCED( CARBON_LIBRARY )
   MARK_AS_ADVANCED( IOKIT_LIBRARY )
   SET(EXTRA_LIBS_CS ${CARBON_LIBRARY} ${IOKIT_LIBRARY})
ENDIF (APPLE)

SET( TARGET_NAME IccXML )

SET( EXTRA_LIBS ${EXTRA_LIBS} ${LIBXML2_LIBRARIES} )

IF(ENABLE_SHARED_LIBS)
  ADD_LIBRARY( ${TARGET_NAME} SHARED ${SOURCES} )
  SET_TARGET_PROPERTIES( ${TARGET_NAME}
    PROPERTIES VERSION ${${PROJECT_NAME}_VERSION}
             SOVERSION ${${PROJECT_NAME}_MAJOR_VERSION}
                     )
  TARGET_LINK_LIBRARIES (
               ${TARGET_NAME} IccProfLib
               ${EXTRA_LIBS} ${EXTRA_LIBS_CS} )
  IF(ENABLE_INSTALL_RIM)
    INSTALL( TARGETS ${TARGET_NAME}
             RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
             LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
             ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR} )
  ENDIF(ENABLE_INSTALL_RIM)
ENDIF(ENABLE_SHARED_LIBS)

IF(ENABLE_STATIC_LIBS)
   ADD_LIBRARY( ${TARGET_NAME}-static STATIC ${SOURCES} )
   TARGET_LINK_LIBRARIES (
                ${TARGET_NAME}-static IccProfLib-static
                ${EXTRA_LIBS} ${EXTRA_LIBS_CS} )

  IF(ENABLE_INSTALL_RIM)
   INSTALL( TARGETS ${TARGET_NAME}-static
            RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
            LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
            ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR} )
  ENDIF(ENABLE_INSTALL_RIM)
ENDIF(ENABLE_STATIC_LIBS)

IF(ENABLE_SHARED_LIBS)
  SET( TARGET_LIB ${TARGET_NAME} )
ELSE(ENABLE_SHARED_LIBS)
  SET( TARGET_LIB ${TARGET_NAME}-static )
ENDIF(ENABLE_SHARED_LIBS)
SET( TARGET_LIB ${TARGET_LIB} PARENT_SCOPE )
